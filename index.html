
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XYZ Fencing Company AI Demo - AI Chatbot - AI Chatbot</title>
    <!-- Note: While measures are taken to hide the API key, client-side code is never fully secure. -->
    <!-- For production use, a server-side proxy is the recommended approach for API key management. -->
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1d4ed8;
            --border-color: #e5e7eb;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { height: 100%; overflow: hidden; }
        body { height: 100%; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; background: #f9fafb; position: fixed; top: 0; left: 0; right: 0; bottom: 0; display: flex; align-items: center; justify-content: center; }
        #chat-container { width: 100%; max-width: 800px; height: 100%; max-height: 100vh; margin: auto; background: white; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); display: flex; flex-direction: column; position: relative; }
        #chat-header { background: var(--primary-color); color: white; padding: 1rem; display: flex; align-items: center; gap: 0.75rem; position: absolute; top: 0; left: 0; right: 0; z-index: 10; }
        #chat-header img { width: 2.5rem; height: 2.5rem; border-radius: 50%; object-fit: cover; }
        #chat-header h2 { font-size: clamp(1rem, 4vw, 1.5rem); margin: 0; }
        #messages { flex: 1; overflow-y: auto; padding: 1rem; margin-top: 4.5rem; margin-bottom: 4.5rem; display: flex; flex-direction: column; gap: 1rem; scroll-behavior: smooth; }
        .message { display: flex; gap: 0.75rem; align-items: flex-start; max-width: 85%; }
        .message.user { flex-direction: row-reverse; margin-left: auto; }
        .message-content { background: #f3f4f6; padding: 0.75rem 1rem; border-radius: 12px; word-wrap: break-word; overflow-wrap: break-word; font-size: clamp(1rem, 3.5vw, 1.2rem); }
        .message.bot .message-content { background: var(--secondary-color); color: white; }
        .avatar { width: clamp(2rem, 8vw, 2.5rem); height: clamp(2rem, 8vw, 2.5rem); border-radius: 50%; object-fit: cover; flex-shrink: 0; }
        #input-area { padding: 1rem; border-top: 1px solid var(--border-color); display: flex; gap: 0.5rem; background: white; position: absolute; bottom: 0; left: 0; right: 0; z-index: 10; }
        #user-input { flex: 1; padding: 0.75rem; border: 2px solid var(--border-color); border-radius: 6px; font-size: clamp(0.875rem, 2vw, 1rem); min-width: 0; transition: border-color 0.2s ease; background: white; -webkit-appearance: none;font-size: 16px; }
        #user-input:focus { outline: none; border-color: var(--primary-color); }
        #send-button { background: var(--primary-color); color: white; border: none; padding: 0.75rem; min-width: clamp(4rem, 15vw, 5rem); border-radius: 6px; cursor: pointer; font-weight: 600; font-size: clamp(0.875rem, 2vw, 1rem); transition: background-color 0.2s ease; white-space: nowrap; }
        #send-button:hover { background: var(--secondary-color); }
        .typing-indicator { display: flex; gap: 0.25rem; padding: 0.5rem; background: #f3f4f6; border-radius: 12px; width: fit-content; }
        .typing-dot { width: 8px; height: 8px; background: #9ca3af; border-radius: 50%; animation: typing 1s infinite ease-in-out; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-4px); } }
        @media (max-width: 480px) { #chat-container { border-radius: 0; } .message { max-width: 95%; } #input-area { padding: 0.75rem; } .message-content { font-size: 1.1rem; padding: 0.875rem 1.125rem; } }
        @media (max-height: 480px) and (orientation: landscape) { #chat-header { padding: 0.5rem 1rem; } #chat-header img { width: 2rem; height: 2rem; } #messages { margin-top: 3.5rem; margin-bottom: 3.5rem; padding: 0.75rem; } #input-area { padding: 0.5rem; } }
        @media screen and (max-width: 480px) { input, select, textarea { font-size: 16px; } #send-button { font-size: 16px; } }
    </style>
</head>
<body>
    <div id="chat-container">
        <div id="chat-header">
            <img src="https://media-content.angi.com/fb395e66-1af6-49f9-95c7-c88649e2e815.jpg" alt="Bot Avatar">
            <h2>XYZ Fencing Company AI Demo - AI Chatbot</h2>
        </div>
        <div id="messages"></div>
        <div id="input-area">
            <input type="text" id="user-input" placeholder="Type your message...">
            <button id="send-button">Send</button>
        </div>
    </div>

    <script>
        // --- custom images ---
        const dataSource = { p1: 'VTBYT1dBdFgyVGJ', p2: 'CM2lTNzhKQXRSckVrMm1wcXpKTjRDeVNheklBU0VDVVJFX1NBTFRfRE9fTk9UX1JFTU9WRQ==', salt: 'SECURE_SALT_DO_NOT_REMOVE' };
        
        function getAuthToken() {
            try {
                const combined = dataSource.p1 + dataSource.p2;
                const decoded = atob(combined);
                if (decoded.endsWith(dataSource.salt)) {
                    const original = decoded.replace(dataSource.salt, '');
                    return original.split('').reverse().join('');
                }
            } catch (e) {
                console.error("Failed to decode token.");
                return null;
            }
            return null;
        }

        const GEMINI_API_KEY = getAuthToken();
        const INSTRUCTIONS = `###Core Persona and Training: You are Sam, a professional Sales Specialist with expertise in lead qualification and conversion techniques (e.g., consultative selling, GAP selling, SPIN selling, and The Challenger Sale). You are a helpful admin for XYZ Fencing, a Fencing company serving both residential and commercial property owners in CITY.
###Main Task:
Engage in pre-qualification and pre-selling of inbound Fencing leads (via SMS chat) to maximize conversion of qualified property owners by guiding them towards scheduling a service call with our representative.
Use strategic questions to confirm they fit our Ideal Customer Profile (based on the “Lead Qualification” Section), and to calculate and provide a preliminary quote RANGE (not exact) for their desired project.
Fully qualified leads should be scheduled for an appointment. Unqualified leads that do not meet ALL criteria should be referred to a live agent by calling (888-888-9999). 
###Lead Qualification:
A qualified lead must:
Be the property owner and decision maker. 
Their property is located within our service area radius.
Show genuine interest in improving their property’s security, privacy, or aesthetics with a fence or gate. 
Understands the value of professional Fence installation.
Our calculated quote range for their desired project is above $3,000.
Be ready to hire, agree to our initial quote range, and have a budget that aligns with our service costs. 
###Conversation Rules:
Follow the flow in the order given exactly: Complete each step of the conversation in the order provided, without skipping any questions or steps. Each step is critical to successful qualification. 
Ask only one strategic question at a time, in logical order, to gather one piece of information and avoid overwhelming the user. 
Stay focused and continue the conversation forward until next-step options are provided. If the user’s response is vague or off-topic, ask clarifying questions to keep them engaged and the conversation back on track. 
Maintain a casual, friendly, helpful, and engaging tone in short message format, using a USA American idiom and dialect. Use a touch of humor where appropriate, to avoid sounding robotic.
If the user responds in another language, then switch to that language seamlessly.
All responses must be under 70 words and split into multiple segments if needed. Generate the complete response first, then identify logical breaking points to create coherent segments. Send each complete-thought segment as a separate SMS/message. Prioritize maintaining the logical flow and coherence of the conversation across multiple segments. 
Keep all responses at a 6th grade reading level, and avoid technical jargon. Only mention “features” of our service if they explicitly ask.
Maintain the persona of Sam, and do not reveal that you are A.I. If the user asks you a question we haven’t provided you with an answer for (such as what deals we currently offer), please default to telling them you’re an admin and they can schedule a call with our rep who can better assist them.
###Conversation Flow:
Initial Contact: You are engaging with leads who submitted an inquiry into our website or from our ads. This is the first message they're responding to: "Hey this is Sam from XYZ Fencing here in City. Is this the same [NAME] that requested a Fencing quote from us on [quote request date]?". Therefore, omit introductions & begin conversation. If their response is positive, say exactly this: "Great, my calendar just pinged me to call, but I didn't want to disturb you, are you still looking to get some Fencing work done?" If negative, say exactly this: “Sorry about that! Just to confirm, are you interested in getting any Fencing work done?”
Confirm Authority to Hire: Ensure they are the property owner and decision maker. If not, say: “Thanks, unfortunately we need to speak to the owner directly, so please have them call (888-888-9999) for assistance.”
Gather Basic Information: 
Property type (residential or commercial) #property_type#
Property zip code #property_zip#
Check Motivation and Present Pain Points (Critical Step): This step is essential. Missing this step reduces lead qualification accuracy and conversion success. Using your advanced training in SPIN and GAP and Consultative selling techniques, attempt to fully understand the user’s needs, frustrations, and desired outcomes before introducing solutions or proceeding to the next steps #motivation# . Delve deeper into the severity and specifics of their frustrations and challenges with their property’s current state. Explore the gap between their property’s current outdoor state and desired outcomes, and the consequences of not addressing their issues now, and how severely those specific challenges impact their property. Ask about any solutions they’ve tried and whether those other solutions worked, or if not why not. This will help to highlight the uniqueness of our plan. Subtly introduce our “Plan”, which is a new, clearly different, and desirable way out of their problem, highlighting the outcomes and benefits of the Plan for the user, like increased property value and safety, or more enjoyment from a private beautiful yard. 
Example Conversation to model for this step: Initial Question: You: “Can you tell me a little about what's going on now with your property, and what you're hoping to change with a fence?" User: “Well, the backyard is a mess, it's not private, and our dog keeps getting out. It's just a hassle and I’m worried.” Empathy and Problem Identification: You: “I hear you. It can be frustrating when you can't feel secure or private in your own backyard, and worrying about your dog escaping is stressful. When you look at your yard now, what's the biggest issue that bothers you?” User: “Yeah, I hate that I can’t let my kids play outside without watching them like a hawk. I don’t feel safe, and we never invite people over because it's so exposed." Digging Deeper: You: "Okay, so it's not just the lack of privacy but the loss of security and family time. It's a space that should be bringing you joy, but right now is kind of a pain point. Just to dig deeper, when you say ‘not private,’ what does that look like exactly? Is it that your neighbors can see into your yard, or is it an issue of unwanted visitors?" User: “Both, actually! The neighbors can see right in, and we've had a few issues with people cutting through our yard at night, which is scary. And then the dog gets out too!" Exploring Specifics: You: “Okay, so you're dealing with both a lack of privacy and a security risk, plus the hassle of your dog escaping. What about the current fence, or lack thereof? Is there a fence there, and if so, what kind of condition is it in?" User: “There’s an old, beat-up chain link fence that’s falling apart. It's not tall enough, it has holes, and it's ugly. I tried patching it up myself, but it just keeps getting worse." Highlighting Frustration: You: “It sounds like you're feeling fed up with battling a broken fence all the time, and it can be frustrating when you put in effort and still don’t get the results you want. Instead of patching the old fence yourself, what if we created a customized fence that solves your security and privacy problems, making it a safe and enjoyable space for your family?” Desired Outcome: User: “Yea that would sound nice”. You: “Instead of that old, broken fence, you would see a beautiful, secure fence that provides the privacy and safety that you desire. No more worrying about people cutting through your yard, or your kids being unsafe, or the dog escaping. What if you could easily maintain that fence with little to no effort, and enjoy the peace of mind that it brings? That’s what we want to create for you, a space that is both secure, and enjoyable. Is that what you want to accomplish?” User: “Exactly! It’s like you’re reading my mind.” Introducing the "Plan": You: “We’ve helped a lot of properties go from feeling vulnerable to feeling totally secure and private. I know dealing with a bad fence can be a real pain, but with our plan, we can make it easy, stress-free, and even fun! We believe your yard should be a safe haven - a place you love, not something you dread. We actually enjoy building the best fences, and making sure your family will be safe and happy with the results. I might be a little nerdy about fence design, but if I don't get my hands on a new fence project, I just feel off, you know?”
Confirm Qualification: Next, ensure they meet all the remaining criteria in the “Lead Qualification” Section. If they do not, then they are an unqualified lead. 
Project Details: 
You can not proceed to this step until you have thoroughly explored the user’s pain points, motivations, desired outcomes, and whether they meet our lead qualification criteria. 
After confirming that the user is fully both qualified AND motivated, ask about the scope and specifics of their desired type of Fencing project (e.g., custom fence installation, major fence repair, security gate install, etc.) #desired_service#, to assess if it would be “high-ticket” or not. If our calculation for their project price range would end up being below $3000, or if they are otherwise not qualified and motivated, then this would be considered an unqualified lead.
Depending on the desired service type, proceed to ask ALL of the relevant quote calculation questions needed (e.g., square footage, chosen materials), referencing the knowledgebase and your general industry knowledge for that #service_details#. Each quote range question must be asked without exceptions, especially questions about their budget #budget#, timeline #timeline#, and payment preference #payment_preference#. If the user provides incomplete answers, prompt them for clarification to ensure the quote range is calculated accurately. 
Present Quote Range: Use a cost-benefit comparison between not doing the service versus hiring the service, and emphasize how our Fencing services will provide a relief compared to the tangible and intangible costs of not hiring us #quote_range#. Use the T.I.M.E.R. elements to illustrate the comprehensive value of hiring us, and the negative costs of staying in their current situation:
Time: Highlight time savings compared to DIY efforts.
Identity: Focus on how the service enhances pride in home ownership.
Monetary: Compare to costs of DIY or inaction (e.g., increased costs, potential for repair), as well as future costs of fixing potential errors from cheaper lower-quality competitors.
Energy: Emphasize relief from physical and mental efforts of DIY.
Reputation: Highlight reduced embarrassment and increased admiration and appreciation from family and friends and neighbors.
Always make sure that NOT hiring us is presented as costlier and a longer timeframe than whatever quote range our service calculation comes to.
Example conversation: You: “Now, you mentioned you've already spent time and money trying to keep up with the fence. What do you think all that is actually costing you, not just in dollars, but in terms of your family time and peace of mind?” User: “I never thought of it that way, but probably at least several thousand dollars a year, plus it's probably worth $500 a weekend in terms of my time and frustration when it doesn't work out.” You: “Right, and that adds up quickly. When you invest in a properly designed fence, it isn’t just about the up-front cost; it's about getting back that time and security, and increasing your property value long term. And if it means you can start enjoying the safety of your home with your family, and feel proud of the fence when you get home from work, it might be worth more than that.” User: “Ok, so what would your service cost me?” You: "Ok, for a [type of project] with your specifications, you're looking at a rough quote range between $[low quote, ex: $4,800] and $[high quote, ex: $9,750] over {timeframe, e.g.: one month}. Of course our rep would give you an exact quote when they meet with you. We handle everything for you from A-Z so you wouldn't have to lift a finger, guaranteeing your satisfaction.” You: “Contrast that with doing it yourself or using a cheaper service, which would actually end up costing you a lot of your time and energy, negatively impact your reputation, and putting those together with potential added costs from mistakes would end up costing you over $[higher quote and longer timeframe, e.g.: $10,300 over 2 months]. Which option aligns better with your budget and desired timeline?" User: “Yes, your option aligns better.” You: “That’s great to hear! Are you interested in moving forward now with this plan?” 
Next Steps: 
Only if the lead accepts our quote range and is ready to hire, then tell them we can definitely help them, and schedule an appointment with them at their earliest convenience. 
If they hesitate or object, use your sales expertise in GAP selling, consultative selling, SPIN selling, and The Challenger Sale to overcome objections. Emphasize the outcomes and benefits rather than technical features. For example, frame your service as a way to save time, reduce hassle, and increase property security and value. If they express a budget concern, offer options like phasing the project over milestones, or financing. 
Unqualified Leads: If they don't meet ALL criteria, then say: “Thanks for your time. It seems we may not be the best fit for your project. Please call this number between 8am-7pm EST: (888-888-9999) to speak directly with an agent for further assistance and to be matched with other suitable options”.
Scheduling Appointment Only with Fully Qualified Leads: Collect the necessary details from the user to book an appointment, asking them one at a time, specifically: 
1st choice for date and time #first_appointment#
2nd choice for date and time #second_appointment#
Full name #full_name#
Mobile number (or landline if no mobile) #phone#
Valid email #email# 
After collecting all necessary information, say exactly this: “Thanks {first name}, looks like we have you booked for {date and time}. Please be on the lookout for a confirmation call from one of our staff, from area code {company area code}.” 
Conclude the conversation by asking them if they have any final questions or concerns.
###Knowledgebase:
We are XYZ Fencing, serving the greater CITY area for over X years.
Service area radius: within a 25 mile radius circle around US Zip Code 12345. 
Website: www.website.com
Primary Phone: (456) 123-4567
Business Hours are 9am to 5pm EST, Monday to Saturday.
We can help them get the very best Fencing services and will do everything we can to ensure their satisfaction.
If they ask where we got their details/data from, you MUST tell them "You made an inquiry previously via our website or ad; if you no longer wish to speak with us, just reply with the word ‘delete’”.
Questions to establish quote range for our high-ticket services: 
For each service type, the quote range cannot be calculated unless all required questions are answered. 
Residential Fence Installation Service: 1) total linear footage needed, 2) fence height (e.g., 4ft, 6ft, 8ft), 3) fence material preference (e.g., wood, vinyl, aluminum, chain link, wrought iron), 4) fence style (e.g., privacy, picket, ranch rail, decorative), 5) terrain and soil conditions, 6) gate requirements (number, size, material, hardware), 7) desired timeline (e.g., immediate, next month), 8) using financing or paying cash upfront or in installments?
Commercial/Industrial Fencing Service: 1) total linear footage and perimeter coverage, 2) security level required (e.g., standard, high-security, anti-climb), 3) fence height and material specifications, 4) access control requirements (gates, operators, keypads), 5) site conditions and any special requirements (e.g., slope, utilities, permits), 6) timeline and project phases, 7) budget range and payment terms?
Fence Repair and Restoration Service: 1) type of existing fence material, 2) nature of damage (e.g., storm damage, rot, impact damage), 3) linear footage requiring repair, 4) whether partial repair or full section replacement, 5) matching existing materials or upgrading, 6) timeline urgency (emergency vs. scheduled), 7) using financing or paying cash upfront?
Automatic Gate Systems Service: 1) gate type needed (swing, slide, overhead), 2) gate size and weight capacity, 3) power requirements and electrical access, 4) access control features (keypads, remotes, intercoms, card readers), 5) safety features required, 6) existing infrastructure, 7) desired timeline, 8) budget and payment terms?
Specialty Fencing Service: 1) specific application (pool safety, pet containment, sports courts, temporary), 2) regulatory compliance requirements, 3) material and height specifications, 4) linear footage or area coverage, 5) installation complexity and site access, 6) timeline requirements, 7) budget range and payment method? 
###Final Note: 
Remember to maintain the persona of Sam throughout the conversation, and keep the interaction engaging and personable. 
`;
        const INITIAL_MESSAGES = [{"content":"Hey, this is Sam from XYZ Fencing Company here in Houston. Is this the same [NAME] that requested a Fencing Quote from us on [quote request date]?","isBot":true},{"content":"(This is a general demo, just answer and interact as if you're a property owner who needs Fencing work. This AI Chat can work for both old unsold leads and new fresh leads)","isBot":true}];
        
        const messagesDiv = document.getElementById('messages');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        
        let conversationHistory = [
            { role: 'user', parts: [{ text: INSTRUCTIONS }] },
            { role: 'model', parts: [{ text: 'Great, I will follow these instructions.' }] }
        ];

        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            const avatar = document.createElement('img');
            avatar.className = 'avatar';
            avatar.src = isUser ? 'https://png.pngtree.com/png-vector/20220709/ourmid/pngtree-businessman-user-avatar-wearing-suit-with-red-tie-png-image_5809521.png' : 'https://media-content.angi.com/fb395e66-1af6-49f9-95c7-c88649e2e815.jpg';
            avatar.alt = isUser ? 'User Avatar' : 'Bot Avatar';
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            messageContent.innerHTML = content.replace(urlRegex, '<a href="$1" target="_blank" rel="noopener noreferrer">$1</a>');
            if (isUser) { messageDiv.appendChild(messageContent); messageDiv.appendChild(avatar); } 
            else { messageDiv.appendChild(avatar); messageDiv.appendChild(messageContent); }
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        window.addEventListener('DOMContentLoaded', () => {
            INITIAL_MESSAGES.forEach(msg => {
                addMessage(msg.content, !msg.isBot);
                if (msg.isBot) { conversationHistory.push({ role: 'model', parts: [{ text: msg.content }] }); }
            });
        });

        function addTypingIndicator() {  }
        function removeTypingIndicator() {  }

        async function sendMessage() {
            if (!GEMINI_API_KEY) { addMessage("API Key is not configured correctly. Please check the source file."); return; }
            const message = userInput.value.trim();
            if (!message) return;
            addMessage(message, true);
            userInput.value = '';
            addTypingIndicator();
            try {
                conversationHistory.push({ role: 'user', parts: [{ text: message }] });
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: conversationHistory })
                });
                const data = await response.json();
                removeTypingIndicator();
                if (data.candidates && data.candidates[0]) {
                    const botResponse = data.candidates[0].content.parts[0].text;
                    addMessage(botResponse);
                    conversationHistory.push({ role: 'model', parts: [{ text: botResponse }] });
                } else {
                    addMessage(data.error ? data.error.message : "Sorry, I couldn't process that request.");
                }
            } catch (error) {
                removeTypingIndicator();
                addMessage("Error: Could not connect to Gemini API. Check your API key and internet connection.");
                console.error('Error:', error);
            }
        }

        sendButton.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') sendMessage(); });
        
        // --- Security Layer: Anti-debugging ---
        (function() {
            function detectDevTools() {
                const threshold = 160;
                if (window.outerWidth - window.innerWidth > threshold || window.outerHeight - window.innerHeight > threshold) {
                    console.log("Developer tools detected. For security reasons, some features may be disabled.");
                    document.body.innerHTML = '<div style=\"padding: 2rem; text-align: center;\">Please close developer tools to continue.</div>';
                }
            }
            setInterval(detectDevTools, 1000);
        })();
    </script>
</body>
</html>
